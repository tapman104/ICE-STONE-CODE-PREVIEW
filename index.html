<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Galaxy Code ‚Äì Rich UI/UX Playground</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;500;600&family=Space+Grotesk:wght@500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: radial-gradient(circle at top, #1b263b 0%, #02010a 45%, #000000 100%);
            --card-bg: rgba(10, 12, 24, 0.9);
            --accent: #4cc9f0;
            --accent-soft: rgba(76, 201, 240, 0.12);
            --accent-strong: #ffbe0b;
            --text-main: #f8f9ff;
            --text-muted: #9094b7;
            --border-soft: rgba(255, 255, 255, 0.08);
            --radius-xl: 24px;
            --radius-md: 999px;
            --shadow-soft: 0 24px 60px rgba(0, 0, 0, 0.75);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            min-height: 100vh;
            font-family: "IBM Plex Sans", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background: var(--bg);
            color: var(--text-main);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 32px 16px;
            overflow: hidden;
        }

        .shell {
            position: relative;
            width: min(1120px, 100%);
            border-radius: var(--radius-xl);
            background: radial-gradient(circle at top left, rgba(76, 201, 240, 0.15), transparent 55%),
                        radial-gradient(circle at bottom right, rgba(255, 190, 11, 0.2), transparent 55%),
                        var(--card-bg);
            box-shadow: var(--shadow-soft);
            border: 1px solid var(--border-soft);
            overflow: hidden;
            padding: 28px 28px 24px;
        }

        .blur-orbit {
            position: absolute;
            inset: -40%;
            background:
                radial-gradient(circle at 10% 0%, rgba(76, 201, 240, 0.22), transparent 55%),
                radial-gradient(circle at 90% 100%, rgba(255, 190, 11, 0.16), transparent 50%);
            opacity: 0.5;
            filter: blur(32px);
            pointer-events: none;
            z-index: 0;
        }

        .frame {
            position: relative;
            z-index: 1;
            display: grid;
            grid-template-columns: minmax(0, 1.25fr) minmax(0, 1fr);
            gap: 28px;
            align-items: center;
        }

        @media (max-width: 900px) {
            body { padding: 20px 12px; }
            .shell { padding: 22px 20px 18px; }
            .frame {
                grid-template-columns: minmax(0, 1fr);
                gap: 20px;
            }
        }

        @media (max-width: 640px) {
            body {
                align-items: flex-start;
                overflow: auto;
            }

            .shell {
                border-radius: 18px;
                padding: 18px 16px 16px;
            }

            .actions {
                flex-direction: column;
                align-items: stretch;
            }

            .btn-primary,
            .btn-ghost {
                width: 100%;
                justify-content: center;
            }

            .settings-launcher {
                top: 12px !important;
                right: 12px !important;
            }

            .settings-card {
                width: min(88vw, 320px);
                top: 58px;
                right: 12px;
                max-height: 82vh;
                overflow-y: auto;
            }
        }

        .badge-row {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            padding: 4px 12px 4px 4px;
            border-radius: 999px;
            background: rgba(5, 9, 22, 0.85);
            border: 1px solid rgba(255, 255, 255, 0.08);
            margin-bottom: 18px;
        }

        .badge-dot {
            width: 26px;
            height: 26px;
            border-radius: 999px;
            background:
                conic-gradient(from 210deg, var(--accent) 0deg 160deg, var(--accent-strong) 160deg 320deg, var(--accent) 320deg 360deg);
            display: grid;
            place-items: center;
            box-shadow: 0 0 12px rgba(76, 201, 240, 0.45);
        }

        .badge-dot::before {
            content: "";
            width: 14px;
            height: 14px;
            border-radius: 999px;
            background: #02051a;
        }

        .badge-text {
            font-size: 0.78rem;
            letter-spacing: 0.14em;
            text-transform: uppercase;
            color: var(--text-muted);
        }

        .title {
            font-size: clamp(2rem, 3vw + 1rem, 3rem);
            line-height: 1.05;
            margin-bottom: 14px;
            font-family: "Space Grotesk", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        }

        .title span.highlight {
            background: linear-gradient(90deg, var(--accent) 0%, var(--accent-strong) 50%, #ff6f91 100%);
            -webkit-background-clip: text;
            color: transparent;
        }

        .subtitle {
            max-width: 32rem;
            font-size: 0.98rem;
            line-height: 1.6;
            color: var(--text-muted);
            margin-bottom: 26px;
            padding: 10px 14px;
            border-radius: 12px;
            background: linear-gradient(120deg, rgba(76, 201, 240, 0.12), rgba(255, 190, 11, 0.08));
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .pill-row {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 26px;
        }

        .pill {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 6px 14px;
            border-radius: 999px;
            border: 1px dashed rgba(255, 255, 255, 0.18);
            background: rgba(2, 5, 20, 0.9);
            font-size: 0.78rem;
            color: var(--text-muted);
        }

        .pill-dot {
            width: 8px;
            height: 8px;
            border-radius: 999px;
            background: #22c55e;
            box-shadow: 0 0 12px rgba(34, 197, 94, 0.85);
        }

        .actions {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            align-items: center;
        }

        .btn-primary {
            border: none;
            outline: none;
            cursor: pointer;
            border-radius: var(--radius-md);
            padding: 10px 22px;
            font-size: 0.96rem;
            font-weight: 600;
            letter-spacing: 0.03em;
            text-transform: uppercase;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            background: linear-gradient(120deg, var(--accent) 0%, #7b5cff 50%, var(--accent-strong) 100%);
            color: #050816;
            box-shadow: 0 16px 40px rgba(11, 155, 255, 0.6);
            transition: transform 0.18s ease, box-shadow 0.18s ease, filter 0.18s ease;
            text-decoration: none;
        }

        .btn-primary span.icon-orbit {
            width: 20px;
            height: 20px;
            border-radius: 999px;
            border: 2px solid #050816;
            display: grid;
            place-items: center;
            background: #ffffff;
        }

        .btn-text {
            display: inline-flex;
            flex-direction: column;
            line-height: 1.05;
            gap: 2px;
        }

        .btn-title {
            font-size: 0.92rem;
            letter-spacing: 0.04em;
        }

        .btn-sub {
            font-size: 0.7rem;
            text-transform: none;
            letter-spacing: 0.02em;
            opacity: 0.75;
        }

        .btn-primary:hover {
            transform: translateY(-1px) scale(1.01);
            filter: brightness(1.02);
            box-shadow: 0 22px 60px rgba(11, 155, 255, 0.8);
        }

        .btn-primary:active {
            transform: translateY(0) scale(0.99);
            box-shadow: 0 12px 32px rgba(11, 155, 255, 0.65);
        }

        .btn-ghost {
            border-radius: var(--radius-md);
            padding: 8px 16px;
            font-size: 0.92rem;
            border: 1px solid rgba(255, 255, 255, 0.18);
            background: rgba(2, 6, 23, 0.45);
            color: rgba(144, 148, 183, 0.85);
            display: inline-flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            transition: background 0.16s ease, color 0.16s ease, border-color 0.16s ease;
        }

        .btn-ghost:hover {
            background: rgba(15, 23, 42, 0.75);
            color: #e5e7ff;
            border-color: rgba(255, 255, 255, 0.6);
        }

        .btn-ghost-dot {
            width: 10px;
            height: 10px;
            border-radius: 999px;
            border: 2px solid rgba(148, 163, 184, 0.6);
        }

        .feature-list {
            margin-top: 18px;
            display: grid;
            gap: 8px;
            font-size: 0.88rem;
            color: rgba(200, 206, 235, 0.9);
        }

        .feature-item {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            background: rgba(2, 6, 23, 0.6);
            padding: 8px 12px;
            border-radius: 999px;
            border: 1px solid rgba(255, 255, 255, 0.06);
            width: fit-content;
        }

        .feature-icon {
            width: 18px;
            height: 18px;
            border-radius: 6px;
            background: linear-gradient(135deg, rgba(76, 201, 240, 0.8), rgba(255, 190, 11, 0.9));
            box-shadow: 0 8px 18px rgba(76, 201, 240, 0.35);
        }

        .right-panel {
            position: relative;
        }

        .preview-shell {
            border-radius: 20px;
            border: 1px solid rgba(148, 163, 184, 0.35);
            background: radial-gradient(circle at top left, rgba(148, 163, 184, 0.22), rgba(15, 23, 42, 1));
            padding: 14px 14px 16px;
            box-shadow: 0 24px 50px rgba(15, 23, 42, 0.95);
        }

        .preview-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
            font-size: 0.78rem;
            color: var(--text-muted);
        }

        .traffic {
            display: inline-flex;
            gap: 6px;
        }

        .traffic span {
            width: 8px;
            height: 8px;
            border-radius: 999px;
        }

        .traffic span:nth-child(1) { background: #fb5f57; }
        .traffic span:nth-child(2) { background: #fcbc2e; }
        .traffic span:nth-child(3) { background: #28c840; }

        .preview-body {
            border-radius: 14px;
            background: rgba(15, 23, 42, 0.95);
            padding: 14px;
            border: 1px solid rgba(15, 23, 42, 0.7);
            font-family: "Fira Code", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
            font-size: 0.78rem;
            color: #e5e7eb;
        }

        .code-line {
            display: flex;
            gap: 10px;
        }

        .code-line span.lno {
            opacity: 0.28;
            min-width: 18px;
            text-align: right;
            user-select: none;
        }

        .code-line span.code {
            white-space: pre;
        }

        .twinkle {
            position: absolute;
            inset: 0;
            pointer-events: none;
            opacity: 0.8;
            mix-blend-mode: screen;
        }

        .twinkle span {
            position: absolute;
            width: 3px;
            height: 3px;
            border-radius: 999px;
            background: white;
            opacity: 0.7;
        }

        .twinkle span:nth-child(1) { top: 18%; left: 14%; opacity: 0.45; }
        .twinkle span:nth-child(2) { top: 6%; right: 12%; opacity: 0.8; }
        .twinkle span:nth-child(3) { bottom: 12%; left: 18%; opacity: 0.7; }
        .twinkle span:nth-child(4) { bottom: 4%; right: 18%; opacity: 0.5; }
        /* Visual polish: modal, buttons, focus */
        #settings-btn {
            transition: transform 0.18s ease, box-shadow 0.18s ease;
            will-change: transform;
            position: relative;
        }

        #settings-btn:hover { transform: translateY(-2px) rotate(10deg) scale(1.03); box-shadow: 0 12px 32px rgba(76,201,240,0.12); }
        #settings-btn:focus { outline: none; }
        #settings-btn:focus-visible { box-shadow: 0 0 0 3px rgba(76,201,240,0.12); border-radius:999px; }

        #settings-btn[data-tooltip]::after {
            content: attr(data-tooltip);
            position: absolute;
            right: 0;
            top: 50px;
            background: rgba(2, 6, 23, 0.92);
            color: var(--text-main);
            font-size: 0.72rem;
            padding: 6px 8px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.08);
            opacity: 0;
            transform: translateY(-4px);
            pointer-events: none;
            transition: opacity 0.18s ease, transform 0.18s ease;
            white-space: nowrap;
        }

        #settings-btn:hover::after,
        #settings-btn:focus-visible::after {
            opacity: 1;
            transform: translateY(0);
        }

        #settings-btn.pulse::before {
            content: "";
            position: absolute;
            inset: -6px;
            border-radius: 999px;
            border: 1px solid rgba(76, 201, 240, 0.5);
            animation: pulse-ring 1.4s ease-out infinite;
        }

        @keyframes pulse-ring {
            0% { transform: scale(0.85); opacity: 0.8; }
            70% { transform: scale(1.15); opacity: 0; }
            100% { transform: scale(1.15); opacity: 0; }
        }

        #settings-modal { transition: background 220ms ease, opacity 220ms ease; pointer-events: none; opacity: 0; }
        #settings-modal > div { transform-origin: top right; transform: translateY(-8px) scale(.98); opacity: 0; transition: transform 220ms cubic-bezier(.2,.9,.3,1), opacity 220ms ease; }
        #settings-modal.open { pointer-events: auto; opacity: 1; background: rgba(2,6,12,0.6); }
        #settings-modal.open > div { transform: translateY(0) scale(1); opacity: 1; }

        /* subtle card shadow and rounded look */
        #settings-modal > div { box-shadow: 0 18px 60px rgba(2,6,23,0.9); border-radius: 14px; }

        .settings-card {
            position: absolute;
            top: 60px;
            right: 18px;
            width: 320px;
            border-radius: 12px;
            padding: 16px 16px 18px;
            background: rgba(2,6,23,0.96);
            border: 1px solid rgba(255,255,255,0.06);
            color: var(--text-main);
        }

        /* respect reduced motion */
        @media (prefers-reduced-motion: reduce) {
            #settings-btn, #settings-modal > div { transition: none !important; }
            #settings-btn.pulse::before { animation: none !important; }
        }

        .mini-preview {
            margin-top: 18px;
            display: inline-flex;
            align-items: center;
            gap: 14px;
            padding: 12px 16px;
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.08);
            background: rgba(2, 6, 23, 0.7);
            box-shadow: 0 18px 40px rgba(2, 6, 23, 0.7);
            max-width: 360px;
            animation: floaty 6s ease-in-out infinite;
        }

        .mini-preview svg {
            width: 96px;
            height: 64px;
            border-radius: 12px;
            box-shadow: inset 0 0 0 1px rgba(255,255,255,0.08);
            flex-shrink: 0;
        }

        .mini-preview .mini-text {
            font-size: 0.85rem;
            color: var(--text-muted);
            line-height: 1.4;
        }

        .mini-preview strong {
            display: block;
            color: var(--text-main);
            margin-bottom: 4px;
            letter-spacing: 0.02em;
        }

        @keyframes floaty {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-6px); }
        }

        @media (prefers-reduced-motion: reduce) {
            .mini-preview { animation: none; }
        }
    </style>
</head>
<body>
    <div class="shell">
        <div class="blur-orbit"></div>

        <div class="frame">
            <section>
                <div class="badge-row">
                    <div class="badge-dot"></div>
                    <span class="badge-text">Rich UI ¬∑ Fluid UX ¬∑ Live Code</span>
                </div>

                <h1 class="title">
                    Welcome to <span class="highlight">Galaxy&nbsp;Code</span>
                </h1>

                <p class="subtitle">
                    Design, tweak, and preview HTML experiences in a single, elegant canvas.
                    Open the live playground to see your code come alive with instant preview.
                </p>

                <div class="pill-row">
                    <div class="pill">
                        <span class="pill-dot"></span>
                        Auto-preview while you type
                    </div>
                    <div class="pill">
                        <span class="pill-dot"></span>
                        Light / dark theme aware
                    </div>
                    <div class="pill">
                        <span class="pill-dot"></span>
                        Download as <code>index.html</code>
                    </div>
                </div>

                <div class="actions">
                    <a href="preview.html" class="btn-primary">
                        <span class="icon-orbit" aria-hidden="true">‚ñ∂</span>
                        <span class="btn-text">
                            <span class="btn-title">Open Preview</span>
                            <span class="btn-sub">Launch the live editor</span>
                        </span>
                    </a>

                    <div class="btn-ghost">
                        <span class="btn-ghost-dot"></span>
                        <span>Rich UI ¬∑ Welcome to Galaxy Code</span>
                    </div>
                </div>

                <div class="mini-preview" aria-hidden="true">
                    <svg viewBox="0 0 160 110" role="img" aria-hidden="true">
                        <defs>
                            <linearGradient id="mini-gradient" x1="0" x2="1" y1="0" y2="1">
                                <stop offset="0%" stop-color="#4cc9f0" stop-opacity="0.9" />
                                <stop offset="100%" stop-color="#ffbe0b" stop-opacity="0.9" />
                            </linearGradient>
                        </defs>
                        <rect x="0" y="0" width="160" height="110" rx="14" fill="#0b1020"/>
                        <rect x="10" y="14" width="60" height="6" rx="3" fill="url(#mini-gradient)" />
                        <rect x="10" y="28" width="88" height="6" rx="3" fill="rgba(255,255,255,0.28)" />
                        <rect x="10" y="42" width="72" height="6" rx="3" fill="rgba(255,255,255,0.2)" />
                        <rect x="10" y="68" width="96" height="24" rx="10" fill="rgba(76,201,240,0.25)" />
                        <rect x="112" y="68" width="38" height="24" rx="10" fill="url(#mini-gradient)" />
                    </svg>
                    <div class="mini-text">
                        <strong>Live preview, instantly</strong>
                        See changes render as you type, then export the final HTML.
                    </div>
                </div>

                <div class="feature-list" role="list">
                    <div class="feature-item" role="listitem">
                        <span class="feature-icon" aria-hidden="true"></span>
                        Edit with comfort and focus
                    </div>
                    <div class="feature-item" role="listitem">
                        <span class="feature-icon" aria-hidden="true"></span>
                        Preview changes in real time
                    </div>
                    <div class="feature-item" role="listitem">
                        <span class="feature-icon" aria-hidden="true"></span>
                        Download a clean HTML file
                    </div>
                </div>
            </section>

            <section class="right-panel" aria-hidden="true">
                <div class="preview-shell">
                    <header class="preview-header">
                        <div>
                            <div class="traffic">
                                <span></span><span></span><span></span>
                            </div>
                            <span style="margin-left:10px;">galaxy-code / preview.html</span>
                        </div>
                        <span>live preview</span>
                    </header>

                    <div class="preview-body">
                        <div class="code-line">
                            <span class="lno">01</span>
                            <span class="code">&lt;!-- Galaxy Code Preview --&gt;</span>
                        </div>
                        <div class="code-line">
                            <span class="lno">02</span>
                            <span class="code">&lt;button&gt;Open Playground&lt;/button&gt;</span>
                        </div>
                        <div class="code-line">
                            <span class="lno">03</span>
                            <span class="code">// auto-updates as you type ‚ú®</span>
                        </div>
                    </div>
                </div>

                <div class="twinkle">
                    <span></span><span></span><span></span><span></span>
                </div>
            </section>
        </div>
    </div>
    <!-- Settings launcher (top-right) -->
    <div class="settings-launcher" style="position:fixed;top:18px;right:18px;z-index:1200;">
        <button id="settings-btn" title="Settings" aria-label="Settings" aria-controls="settings-modal" aria-expanded="false" data-tooltip="Settings" class="pulse" style="width:40px;height:40px;border-radius:999px;border:none;background:rgba(255,255,255,0.04);color:var(--text-main);cursor:pointer;">‚öô</button>
    </div>

    <!-- Settings modal -->
    <div id="settings-modal" role="dialog" aria-modal="true" aria-labelledby="settings-title" aria-hidden="true" style="position:fixed;inset:0;z-index:1190;">
        <div class="settings-card">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;">
                <strong id="settings-title" style="letter-spacing:0.06em;text-transform:uppercase;font-size:0.78rem;color:var(--text-muted);">Settings</strong>
                <button id="settings-close" style="background:transparent;border:none;color:var(--text-muted);font-size:18px;cursor:pointer;">‚úï</button>
            </div>

            <div style="display:flex;flex-direction:column;gap:12px;">
                <div>
                    <div style="font-size:0.72rem;color:var(--text-muted);letter-spacing:0.06em;text-transform:uppercase;margin-bottom:8px;">Theme</div>
                    <label style="display:flex;align-items:center;gap:8px"><input type="radio" name="site-theme" id="idx-theme-dark" value="dark" checked> Dark</label>
                    <label style="display:flex;align-items:center;gap:8px"><input type="radio" name="site-theme" id="idx-theme-light" value="light"> Light</label>
                </div>

                <div style="height:1px;background:rgba(255,255,255,0.04)"></div>

                <div>
                    <div style="font-size:0.72rem;color:var(--text-muted);letter-spacing:0.06em;text-transform:uppercase;margin-bottom:8px;">About</div>
                    <div style="display:flex;gap:10px;align-items:center;">
                        <img id="idx-gh-avatar" data-src="https://github.com/tapman104.png" alt="avatar" width="56" height="56" style="border-radius:8px;object-fit:cover;border:1px solid rgba(255,255,255,0.06);opacity:0.95">
                        <div>
                            <div id="idx-gh-name" style="font-weight:600">tapman104</div>
                            <a id="idx-gh-link" href="https://github.com/tapman104" target="_blank" rel="noopener noreferrer" style="color:var(--accent);text-decoration:none;font-size:0.88rem;display:inline-block;margin-bottom:6px;">View on GitHub</a>
                            <br>
                            <a id="idx-gh-repo" href="https://github.com/tapman104/ICE-STONE-CODE-PREVIEW" target="_blank" rel="noopener noreferrer" style="color:var(--accent);text-decoration:none;font-size:0.82rem;">ICE-STONE-CODE-PREVIEW</a>
                            <br>
                            <a id="idx-buymeacoffee" href="https://buymeacoffee.com/tapman" target="_blank" rel="noopener noreferrer" style="color:var(--accent);text-decoration:none;font-size:0.82rem;display:inline-block;margin-top:6px;">Buy Me a Coffee</a>
                            <div id="idx-gh-bio" style="font-size:0.82rem;color:var(--text-muted);margin-top:6px;max-width:200px;">GitHub profile</div>
                            <div style="margin-top:8px;font-size:0.86rem;color:var(--text-muted)">‚≠ê <strong id="idx-gh-stars">‚Äî</strong> &nbsp; üç¥ <strong id="idx-gh-forks">‚Äî</strong> &nbsp; üè∑ <strong id="idx-gh-release">‚Äî</strong></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        (function(){
            const settingsBtn = document.getElementById('settings-btn');
            const settingsModal = document.getElementById('settings-modal');
            const settingsClose = document.getElementById('settings-close');
            const themeDark = document.getElementById('idx-theme-dark');
            const themeLight = document.getElementById('idx-theme-light');

            function trapFocus(modal){
                const focusable = Array.from(
                    modal.querySelectorAll('a[href], button:not([disabled]), input, select, textarea, [tabindex]:not([tabindex="-1"])')
                ).filter(el => el.offsetParent !== null);
                if(focusable.length === 0) return () => {};
                let i = 0;
                const keyHandler = (e) => {
                    if(e.key === 'Tab'){
                        e.preventDefault();
                        i = (i + (e.shiftKey ? -1 : 1) + focusable.length) % focusable.length;
                        focusable[i].focus();
                    }
                    if(e.key === 'Escape') { closeSettings(); }
                };
                document.addEventListener('keydown', keyHandler);
                focusable[0].focus();
                return () => document.removeEventListener('keydown', keyHandler);
            }

            let releaseTrap = null;
            function openSettings(){
                settingsModal.classList.add('open');
                settingsModal.style.pointerEvents = 'auto';
                settingsModal.setAttribute('aria-hidden','false');
                settingsBtn.setAttribute('aria-expanded', 'true');
                ensureIdxGithub();
                if(settingsBtn) settingsBtn.classList.remove('pulse');
                if(releaseTrap) releaseTrap();
                releaseTrap = trapFocus(settingsModal);
            }
            function closeSettings(){
                const wasOpen = settingsModal.classList.contains('open');
                settingsModal.classList.remove('open');
                settingsModal.style.pointerEvents = 'none';
                settingsModal.setAttribute('aria-hidden','true');
                settingsBtn.setAttribute('aria-expanded', 'false');
                if(releaseTrap){
                    releaseTrap();
                    releaseTrap = null;
                }
                if(wasOpen && settingsBtn) settingsBtn.focus();
            }

            settingsBtn.addEventListener('click', (e)=>{ e.stopPropagation(); if(settingsModal.classList.contains('open')) closeSettings(); else openSettings(); });
            settingsClose.addEventListener('click', closeSettings);
            settingsModal.addEventListener('click', (e)=>{ if(e.target === settingsModal) closeSettings(); });
            document.addEventListener('keydown', (e)=>{ if(e.key==='Escape' && settingsModal.classList.contains('open')) closeSettings(); });

            // Subtle first-load pulse for discoverability
            if (settingsBtn) {
                try {
                    const reduceMotion = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;
                    if (reduceMotion) {
                        settingsBtn.classList.remove('pulse');
                    } else {
                        setTimeout(() => settingsBtn.classList.remove('pulse'), 4200);
                    }
                } catch (e) {
                    settingsBtn.classList.remove('pulse');
                }
            }

            // Theme handling
            function applyTheme(t){
                document.documentElement.setAttribute('data-theme', t);
                try{ localStorage.setItem('theme', t); }catch(e){}
            }

            themeDark.addEventListener('change', ()=>{ if(themeDark.checked) applyTheme('dark'); });
            themeLight.addEventListener('change', ()=>{ if(themeLight.checked) applyTheme('light'); });

            // load saved theme
            const saved = (localStorage.getItem && localStorage.getItem('theme')) || 'dark';
            applyTheme(saved);
            if(saved === 'dark') themeDark.checked = true; else themeLight.checked = true;

            // Lazy-load GitHub user + repo info with 12h cache
            const IDX_GH_CACHE = 'idx_gh_cache_v1';
            const IDX_USER = 'tapman104';
            const IDX_REPO = 'ICE-STONE-CODE-PREVIEW';

            async function fetchIdxGithub(){
                try{
                    const cached = JSON.parse(localStorage.getItem(IDX_GH_CACHE) || 'null');
                    const twelveHours = 12 * 60 * 60 * 1000;
                    if(cached && (Date.now() - cached.ts) < twelveHours) return cached.data;

                    const [uRes, rRes] = await Promise.all([
                        fetch(`https://api.github.com/users/${IDX_USER}`),
                        fetch(`https://api.github.com/repos/${IDX_USER}/${IDX_REPO}`)
                    ]);
                    if(!uRes.ok || !rRes.ok) throw new Error('GitHub error');
                    const user = await uRes.json();
                    const repo = await rRes.json();
                    const data = { user, repo };
                    try{ localStorage.setItem(IDX_GH_CACHE, JSON.stringify({ ts: Date.now(), data })); }catch(e){}
                    return data;
                }catch(err){ return null; }
            }

            function populateIdxGithub(data){
                if(!data) return;
                const { user, repo } = data;
                const avatar = document.getElementById('idx-gh-avatar');
                const name = document.getElementById('idx-gh-name');
                const bio = document.getElementById('idx-gh-bio');
                const link = document.getElementById('idx-gh-link');
                const stars = document.getElementById('idx-gh-stars');
                const forks = document.getElementById('idx-gh-forks');
                const rel = document.getElementById('idx-gh-release');
                if(avatar && user.avatar_url) avatar.src = user.avatar_url;
                if(name && (user.name || user.login)) name.textContent = user.name || user.login;
                if(bio) bio.textContent = user.bio || '';
                if(link && user.html_url) link.href = user.html_url;
                if(stars) stars.textContent = repo.stargazers_count ?? '‚Äî';
                if(forks) forks.textContent = repo.forks_count ?? '‚Äî';
                if(rel) rel.textContent = repo?.pushed_at ? new Date(repo.pushed_at).toISOString().slice(0,10) : '‚Äî';
            }

            let _idxLoaded = false;
            function ensureIdxGithub(){
                if(_idxLoaded) return; _idxLoaded = true;
                fetchIdxGithub().then(populateIdxGithub).catch(()=>{});
            }

        })();
    </script>

</body>
</html>
